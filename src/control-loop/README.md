# 第6章 制御構造（ループ）

##  対応C規格
- **主要対象:** C90
- **学習内容:** for文、while文、do-while文、break文、continue文、ネストしたループ

##  学習目標

この章を完了すると、以下のことができるようになります：

- for文を使った繰り返し処理ができる
- while文とdo-while文の違いを理解する
- break文とcontinue文を適切に使える
- ネストしたループを理解して活用できる
- ループを使った実践的なプログラムを作成できる

##  概要と詳細

### 繰り返し処理とは？

プログラミングでは、同じ処理を何度も繰り返したい場面がたくさんあります。例えば：

- 1から100までの数を全て表示する
- 成績データを100人分処理する  
- ゲームのメインループ（ユーザーが終了するまで続ける）
- ファイルのデータを最後まで読み込む

これらを一つ一つ手作業で書くのは大変です。そこで「ループ（繰り返し）」を使います！

#### なぜループが重要なの？

コンピュータの強みは「高速で正確な繰り返し処理」です。人間が苦手とする単調な繰り返し作業を、コンピュータは疲れることなく実行できます。この能力を活用するのがループです。

### for文 

最も一般的なループ文で、初期化・条件・更新を一箇所で記述できます。

#### for文の仕組みを理解しよう

for文は「カウンター付きの繰り返し」と考えると分かりやすいです。例えば、ラジオ体操を10回やるとき：

1. 最初は1回目から始める（初期化）
2. 10回以下なら続ける（条件）
3. 1回終わったら回数を増やす（更新）

これをコードで表現すると：

```c
for (int i = 1; i <= 10; i++) {
    printf("%d回目のラジオ体操\n", i);
}
```

#### 基本構文

```c
for (初期化; 条件式; 更新式) 
    /* 繰り返し実行される文 */

```

#### 基本的な使用例

```c
#include <stdio.h>

int main(void)
{

    int i;
    
    /* 1から10まで出力 */
    for (i = 1; i <= 10; i++) {
        printf("%d ", i);
    }
    
    printf("\n");
    
    return 0;

```

#### for文の詳細動作

```c
for (i = 0; i < 5; i++) {
    printf("i = %d\n", i);
}

/* 上記は以下と同等 */
i = 0;              /* ① 初期化（1回のみ実行） */
while (i < 5) {     /* ② 条件チェック */
    printf("i = %d\n", i);  /* ③ ループ本体 */
    i++;            /* ④ 更新式 */
}
```

**実行の流れ：**
1. 初期化 → i = 0
2. 条件チェック → 0 < 5は真、続行
3. ループ本体実行 → "i = 0"を表示
4. 更新 → i = 1
5. 条件チェック → 1 < 5は真、続行
6. ...これを繰り返し...
7. 更新 → i = 5
8. 条件チェック → 5 < 5は偽、ループ終了

#### さまざまなfor文のパターン

for文は非常に柔軟で、色々な書き方ができます：

```c
/* 逆順ループ（カウントダウン） */
for (i = 10; i >= 1; i--) {
    printf("%d ", i);
}
printf("発射！\n");

/* 2つずつ増加（偶数だけ表示） */
for (i = 0; i <= 20; i += 2) {
    printf("%d ", i);
}

/* 複数変数の制御（両端から中央へ） */
for (i = 0, j = 10; i < j; i++, j--) {
    printf("i=%d, j=%d\n", i, j);
}

/* 無限ループ（条件式を省略） */
for (;;) {
    /* Ctrl+Cで止めるまで続く */
    printf("無限ループ中...\n");
}
```

**初心者のためのヒント：**
- 最初は基本形（`for (i = 0; i < n; i++)`）をマスターしましょう
- 複雑なfor文は読みにくくなりがちなので、シンプルに保つことが大切です

```

#### さまざまなfor文のパターン

```c

```

### while文 

条件が真である間、繰り返し処理を実行します。

#### while文って何？

while文は「〜である間、繰り返す」という意味です。条件が満たされている限り、処理を続けます。

**日常生活での例：**
- お風呂にお湯を入れる → 「満タンになるまで」続ける
- 宿題をする → 「全部終わるまで」続ける
- 電車を待つ → 「電車が来るまで」待つ

これらは全て「ある条件が満たされるまで続ける」パターンです。

#### 基本構文

```c
while (条件式) 
    /* 繰り返し実行される文 */

```

#### while文の使用例

```c
#include <stdio.h>

int main(void)
{

    int count = 1;
    
    while (count <= 5) {
        printf("count = %d\n", count);
        count++;
    }
    
    
    return 0;

```

#### while文の実践例

```c
/* ユーザー入力の処理 */
int number;
printf("正の数を入力してください（0で終了）: ");

while (scanf("%d", &number) == 1 && number > 0) {
    printf("入力された数: %d\n", number);
    printf("次の数を入力してください（0で終了）: ");
}


printf("プログラムを終了します。\n");
```

**for文とwhile文の使い分け：**
- **for文**：繰り返し回数が分かっている場合（例：10回繰り返す）
- **while文**：条件で終了を判断する場合（例：ユーザーが0を入力するまで）
```

### do-while文 

最低1回は実行され、その後条件をチェックするループです。

#### do-while文の特徴

while文との大きな違いは「条件チェックのタイミング」です：

- **while文**：最初に条件をチェック（条件が偽なら一度も実行されない）
- **do-while文**：最後に条件をチェック（必ず一度は実行される）

**日常生活での例：**

レストランでの注文を考えてみましょう：
1. メニューを見せる（必ず一度は見せる）
2. 注文を聞く
3. 「他に注文はありますか？」と聞く
4. 「はい」なら1に戻る、「いいえ」なら終了

これがdo-while文の考え方です！

#### 基本構文

```c
do 
    /* 最低1回は実行される文 */
 while (条件式);
```

#### do-while文の使用例

```c
#include <stdio.h>

int main(void)
{

    int choice;
    
    do {
        printf("\nメニュー:\n");
        printf("1. オプション1\n");
        printf("2. オプション2\n");
        printf("3. 終了\n");
        printf("選択してください: ");
        scanf("%d", &choice);
        
        switch (choice) {
            case 1:
                printf("オプション1が選択されました\n");
                break;
            case 2:
                printf("オプション2が選択されました\n");
                break;
            case 3:
                printf("プログラムを終了します\n");
                break;
            default:
                printf("無効な選択です\n");
                break;
        }
    } while (choice != 3);
    
    return 0;

```

### break文とcontinue文 ⏭

ループの流れを制御する特別な文です。

#### 途中でループを抜けたいとき

プログラムを書いていると、「ある条件を満たしたらループを抜けたい」という場面があります。そんなときに使うのがbreak文とcontinue文です。

**日常生活での例：**
- **break**：探し物が見つかったら探すのをやめる
- **continue**：嫌いな野菜は飛ばして次の料理を食べる

#### break文

ループを強制的に終了します。

```c
#include <stdio.h>

int main(void)
{

    int i;
    
    for (i = 1; i <= 10; i++) {
        if (i == 5) {
            break;  /* i が 5 のときループを抜ける */
        }
        printf("%d ", i);
    }
    printf("\nループを抜けました\n");
    
    return 0;

/* 出力: 1 2 3 4 */
```

#### continue文

現在の繰り返しをスキップして、次の繰り返しに進みます。

```c
#include <stdio.h>

int main(void)
{

    int i;
    
    for (i = 1; i <= 10; i++) {
        if (i % 2 == 0) {
            continue;  /* 偶数の場合はスキップ */
        }
        printf("%d ", i);
    }
    printf("\n");
    
    return 0;

/* 出力: 1 3 5 7 9 */
```

### ネストしたループ 

ループの中にさらにループを含む構造です。

#### 二重ループを理解しよう

ネストしたループは「ループの中にループ」がある構造です。

**日常生活での例：**

学校の時間割を考えてみましょう：
- 外側のループ：月曜日から金曜日まで（5回）
- 内側のループ：1時間目から6時間目まで（6回）
- 合計：5日 × 6時間 = 30コマ

これがネストしたループの考え方です！

#### 二重ループの例

```c
#include <stdio.h>

int main(void)
{

    int i, j;
    
    /* 九九表の作成 */
    for (i = 1; i <= 9; i++) {
        for (j = 1; j <= 9; j++) {
            printf("%3d ", i * j);
        }
        printf("\n");
    }
    
    return 0;

```

#### 三角形パターンの出力

```c
#include <stdio.h>

int main(void)
{

    int i, j;
    
    /* 星印の三角形 */
    for (i = 1; i <= 5; i++) {
        for (j = 1; j <= i; j++) {
            printf("* ");
        }
        printf("\n");
    }
    
    return 0;

/*
出力:
* 
* * 
* * * 
* * * * 
* * * * * 
*/
```

### ループでのbreak・continueの応用 

#### ネストしたループでのbreak

```c
#include <stdio.h>

int main(void)
{

    int i, j;
    int found = 0;
    
    for (i = 1; i <= 10 && !found; i++) {
        for (j = 1; j <= 10; j++) {
            if (i * j == 36) {
                printf("発見: %d * %d = 36\n", i, j);
                found = 1;
                break;  /* 内側のループを抜ける */
            }
        }
    }
    
    return 0;

```

#### ラベル付きbreak（goto文を使用）

```c
#include <stdio.h>

int main(void)
{

    int i, j;
    
    for (i = 1; i <= 10; i++) {
        for (j = 1; j <= 10; j++) {
            if (i * j == 36) {
                printf("発見: %d * %d = 36\n", i, j);
                goto exit_loops;  /* 両方のループを抜ける */
            }
        }
    }
    
exit_loops:
    printf("ループ終了\n");
    return 0;

```

### 無限ループ ♾

意図的に終了しないループを作成することもあります。

#### 無限ループの作成方法

```c
/* 方法1: for文 */
for (;;) {
    /* 無限ループ */
    if (条件) {
        break;
    }
}


/* 方法2: while文 */
while (1) {
    /* 無限ループ */
    if (条件) {
        break;
    }
}


/* 方法3: do-while文 */
do {
    /* 無限ループ */
    if (条件) {
        break;
    }
} while (1);
```

#### 無限ループの実用例

```c
#include <stdio.h>

int main(void)
{

    int choice;
    
    while (1) {  /* 無限ループ */
        printf("\n=== 計算機 ===\n");
        printf("1. 足し算\n");
        printf("2. 引き算\n");
        printf("3. 終了\n");
        printf("選択: ");
        
        if (scanf("%d", &choice) != 1) {
            printf("入力エラー\n");
            break;
        }
        
        if (choice == 3) {
            printf("終了します\n");
            break;
        }
        
        /* 計算処理... */
    }
    
    return 0;

```

### ループの最適化とベストプラクティス 

#### 効率的なループ

```c
/* NG: 毎回strlen()を呼び出し */
for (i = 0; i < strlen(str); i++) {
    /* 処理 */
}


/* OK: 長さを事前に計算 */
len = strlen(str);
for (i = 0; i < len; i++) {
    /* 処理 */
}

```

#### ループ変数の適切な使用

```c
int main(void)
{

    int i;  /* C90では関数の先頭で宣言 */
    
    for (i = 0; i < 10; i++) {
        /* iはループ外でも有効 */
    }
    
    printf("最終的なi = %d\n", i);  /* 10が出力 */
    
    return 0;

```

##  サンプルコード

### 基本的なループ例

プログラムファイル: `examples/loop_basic.c`

for、while、do-while文の基本的な使用方法を学習します。

### ネストしたループ

プログラムファイル: `examples/nested_loops.c`

二重・三重ループの使用例を学習します。

### break・continue文

プログラムファイル: `examples/break_continue.c`

ループ制御文の使い方を学習します。

### コンパイルと実行

```bash
# examples ディレクトリに移動
cd examples

# C90準拠でコンパイル
gcc -std=c90 -Wall -Wextra -pedantic loop_basic.c -o loop_basic

# 実行
./loop_basic
```

##  演習課題

### 基礎問題

1. **数列の出力**
   - 1から20までの数を出力するプログラムを3種類のループで作成してください

2. **偶数・奇数の判定**
   - 1から50までの数で、偶数のみを出力するプログラムを作成してください

3. **階乗の計算**
   - 入力された数の階乗を計算するプログラムを作成してください

### 応用問題

4. **素数判定**
   - 入力された数が素数かどうかを判定するプログラムを作成してください

5. **フィボナッチ数列**
   - n項目までのフィボナッチ数列を出力するプログラムを作成してください

6. **パターン出力**
   - 以下のようなパターンを出力するプログラムを作成してください：
   ```
   *
   **
   ***
   ****
   *****
   ****
   ***
   **
   *
   ```

### 発展問題

7. **成績管理システム**
   - 複数の学生の成績を入力し、平均・最高・最低点を計算するプログラム

8. **簡易ゲーム**
   - 数当てゲームを作成してください（1-100の範囲で乱数を生成）

9. **データ検索**
   - 配列の中から特定の値を検索するプログラムを作成してください

##  コンパイル方法

この章では以下のMakefileを使用してコンパイルができます：

```bash
# 全ての例題をコンパイル
make all

# 特定のプログラムをコンパイル
make loop_basic

# 実行
make run

# クリーンアップ
make clean
```

##  規格による違い

### C90での制限事項
- ループ変数は関数の先頭で宣言する必要がある
- for文内での変数宣言は不可

### C99以降の拡張
- for文内での変数宣言が可能
  ```c
  for (int i = 0; i < 10; i++)   /* C99以降 */
      /* 処理 */
  
  ```

##  よくある間違い

### 1. 無限ループの作成

```c
/* NG: 終了条件の記述ミス */
for (i = 0; i > 10; i++)   /* 最初から条件が偽 */
    /* 実行されない */


/* NG: 更新式の記述ミス */
for (i = 0; i < 10; i--)   /* 負の方向に進む */
    /* 無限ループ */

```

### 2. セミコロンの位置

```c
/* NG: for文の後にセミコロン */
for (i = 0; i < 10; i++);  /* 空文が実行される */

    printf("%d\n", i);     /* ループ外で実行 */


/* OK: 正しい記述 */
for (i = 0; i < 10; i++) 
    printf("%d\n", i);

```

### 3. ループ変数の範囲外アクセス

```c
/* NG: 配列の範囲を超える */
int arr[10];
for (i = 0; i <= 10; i++)   /* i=10で範囲外 */
    arr[i] = i;


/* OK: 正しい範囲 */
for (i = 0; i < 10; i++) 
    arr[i] = i;

```

##  次の章へ

ループ処理を理解したら、[配列](../arrays/README.md) に進んでください。

##  参考資料

- [for文詳細](https://ja.cppreference.com/w/c/language/for)
- [while文詳細](https://ja.cppreference.com/w/c/language/while)
- [break・continue文](https://ja.cppreference.com/w/c/language/break)
