# 繰り返し処理

##  対応C規格

- **主要対象:** C90
- **学習内容:** for文、while文、do-while文、break文、continue文、ネストしたループ

##  学習目標
この章を完了すると、以下のことができるようになります。

- for文を使った繰り返し処理ができる
- while文とdo-while文の違いを理解する
- break文とcontinue文を適切に使える
- ネストしたループを理解して活用できる
- ループを使った実践的なプログラムを作成できる

##  概要と詳細

### 繰り返し処理とは？

プログラミングでは、同じ処理を何度も繰り返したい場面がたくさんあります。例えば。

- 1から100までの数を全て表示する
- 成績データを100人分処理する  
- ゲームのメインループ（ユーザーが終了するまで続ける）
- ファイルのデータを最後まで読み込む
これらを一つ一つ手作業で書くのは大変です。そこで「ループ（繰り返し）」を使います！

#### なぜループが重要なの？

コンピュータの強みは「高速で正確な繰り返し処理」です。人間が苦手とする単調な繰り返し作業を、コンピュータは疲れることなく実行できます。この能力を活用するのがループです。

### for文 
最も一般的なループ文で、初期化・条件・更新を一箇所で記述できます。

#### for文の仕組みを理解しよう
for文は「カウンター付きの繰り返し」と考えると分かりやすいです。

例えば、ラジオ体操を10回行う場合を考えてみましょう。

1. 最初は1回目から始める（初期化）
2. 10回以下なら続ける（条件）  
3. 1回終わったら回数を増やす（更新）

この流れをコードで表現すると、次のようになります。

```c
for (int i = 1; i <= 10; i++) {
    printf("%d回目のラジオ体操\n", i);
}
```

#### 基本構文

```c
for (初期化; 条件式; 更新式) {
    /* 繰り返し実行される文 */
}
```

#### 基本的な使用例

```c
#include <stdio.h>
int main(void)
{
    int i;
    
    /* 基本的なfor文 */
    printf("1から5まで: ");
    for (i = 1; i <= 5; i++) {
        printf("%d ", i);
    }
    printf("\n");
    
    return 0;
}
```

#### for文の詳細動作
for文がどのように動作するか、ステップごとに見てみましょう。

```c
for (i = 0; i < 5; i++) {
    printf("i = %d\n", i);
}

/* 上記は以下と同等 */
i = 0;              /* ① 初期化（1回のみ実行） */
while (i < 5) {     /* ② 条件チェック */
    printf("i = %d\n", i);  /* ③ ループ本体 */
    i++;            /* ④ 更新式 */
}
```
**実行の流れ：**

1. 初期化 → i = 0
2. 条件チェック → 0 < 5は真、続行
3. ループ本体実行 → "i = 0"を表示
4. 更新 → i = 1
5. 条件チェック → 1 < 5は真、続行
6. ...これを繰り返し...
7. 更新 → i = 5
8. 条件チェック → 5 < 5は偽、ループ終了

#### さまざまなfor文のパターン
for文は非常に柔軟で、色々な書き方ができます。

```c
/* 逆順ループ（カウントダウン） */
for (i = 10; i >= 1; i--) {
    printf("%d ", i);
}
printf("発射！\n");

/* 2つずつ増加（偶数だけ表示） */
for (i = 0; i <= 20; i += 2) {
    printf("%d ", i);
}

/* 複数変数の制御（両端から中央へ） */
for (i = 0, j = 10; i < j; i++, j--) {
    printf("i=%d, j=%d\n", i, j);
}

/* 無限ループ（条件式を省略） */
for (;;) {
    /* Ctrl+Cで止めるまで続く */
    printf("無限ループ中...\n");
}
```
**初心者のためのヒント：**

- 最初は基本形（`for (i = 0; i < n; i++)`）をマスターしましょう
- 複雑なfor文は読みにくくなりがちなので、シンプルに保つことが大切です

### while文 
条件が真である間、繰り返し処理を実行します。

#### while文って何？

while文は「〜である間、繰り返す」という意味です。条件が満たされている限り、処理を続けます。
**日常生活での例：**

- お風呂にお湯を入れる → 「満タンになるまで」続ける
- 宿題をする → 「全部終わるまで」続ける
- 電車を待つ → 「電車が来るまで」待つ
これらは全て「ある条件が満たされるまで続ける」パターンです。

#### 基本構文

```c
while (条件式) {
    /* 繰り返し実行される文 */
}
```

#### while文の使用例

```c
#include <stdio.h>
int main(void)
{
    int count = 1;
    
    printf("while文の例: ");
    while (count <= 5) {
        printf("%d ", count);
        count++;
    }
    printf("\n");
    
    return 0;
}
```

#### while文の実践例
while文は「回数が分からない繰り返し」に最適です。

```c
/* ユーザー入力の処理 */
int number;
printf("正の数を入力してください（0で終了）: ");
while (scanf("%d", &number) == 1 && number > 0) {
    printf("入力された数: %d\n", number);
    printf("次の数を入力してください（0で終了）: ");
}
printf("プログラムを終了します。\n");
```
**for文とwhile文の使い分け：**

- **for文**：繰り返し回数が分かっている場合（例：10回繰り返す）
- **while文**：条件で終了を判断する場合（例：ユーザーが0を入力するまで）

### do-while文 
最低1回は実行され、その後条件をチェックするループです。

#### do-while文の特徴
while文との大きな違いは「条件チェックのタイミング」です。

- **while文**：最初に条件をチェック（条件が偽なら一度も実行されない）
- **do-while文**：最後に条件をチェック（必ず一度は実行される）
**日常生活での例：**
レストランでの注文を考えてみましょう。

1. メニューを見せる（必ず一度は見せる）
2. 注文を聞く
3. 「他に注文はありますか？」と聞く
4. 「はい」なら1に戻る、「いいえ」なら終了
これがdo-while文の考え方です！

#### 基本構文

```c
do {
    /* 最低1回は実行される文 */
} while (条件式);
```

#### do-while文の使用例

```c
#include <stdio.h>
int main(void)
{
    int num;
    
    do {
        printf("正の数を入力（0で終了）: ");
        scanf("%d", &num);
        if (num > 0) {
            printf("入力値: %d\n", num);
        }
    } while (num != 0);
    
    printf("終了します\n");
    return 0;
}
```

### break文とcontinue文 
ループの流れを制御する特別な文です。

#### 途中でループを抜けたいとき
プログラムを書いていると、「ある条件を満たしたらループを抜けたい」という場面があります。そんなときに使うのがbreak文とcontinue文です。
**日常生活での例：**

- **break**：探し物が見つかったら探すのをやめる
- **continue**：嫌いな野菜は飛ばして次の料理を食べる

#### break文
ループを強制的に終了します。

```c
#include <stdio.h>
int main(void)
{
    int i;
    
    for (i = 1; i <= 10; i++) {
        if (i == 5) {
            printf("\n5で終了
");
            break;
        }
        printf("%d ", i);
    }
    
    return 0;
}
```

#### continue文
現在の繰り返しをスキップして、次の繰り返しに進みます。

```c
#include <stdio.h>
int main(void)
{
    int i;
    
    printf("奇数のみ: ");
    for (i = 1; i <= 10; i++) {
        if (i % 2 == 0) {
            continue;  /* 偶数をスキップ */
        }
        printf("%d ", i);
    }
    printf("\n");
    
    return 0;
}
```

### ネストしたループ 
ループの中にさらにループを含む構造です。

#### 二重ループを理解しよう
ネストしたループは「ループの中にループ」がある構造です。
**日常生活での例：**
学校の時間割を考えてみましょう。

- 外側のループ：月曜日から金曜日まで（5回）
- 内側のループ：1時間目から6時間目まで（6回）
- 合計：5日 × 6時間 = 30コマ
これがネストしたループの考え方です！

#### 二重ループの例

```c
#include <stdio.h>
int main(void)
{
    int i, j;
    
    /* 九九の表（3x3のみ） */
    for (i = 1; i <= 3; i++) {
        for (j = 1; j <= 3; j++) {
            printf("%2d ", i * j);
        }
        printf("\n");
    }
    
    return 0;
}
```

#### 三角形パターンの出力

```c
#include <stdio.h>
int main(void)
{
    int i, j;
    int n = 5;
    
    /* 上向き三角形 */
    for (i = 1; i <= n; i++) {
        for (j = 1; j <= i; j++) {
            printf("* ");
        }
        printf("\n");
    }
    
    return 0;
}
```

### ループでのbreak・continueの応用 

#### ネストしたループでのbreak

```c
/*
 * ネストしたループでのbreak文の動作
 * 
 * breakは最も内側のループのみを抜ける
 */
#include <stdio.h>
int main(void)
{
    int i, j;
    
    printf("===== ネストしたループでのbreak =====\n");
    
    /* 例1: 内側のループでbreak */
    printf("\n例1: 内側のループでbreak\n");
    for (i = 1; i <= 3; i++) {
        printf("外側ループ: i = %d\n", i);
        for (j = 1; j <= 5; j++) {
            if (j == 3) {
                printf("  内側でbreak (j = %d)\n", j);
                break;  /* 内側のループのみ終了 */
            }
            printf("  内側ループ: j = %d\n", j);
        }
        printf("外側ループは継続\n");
    }
    
    /* 例2: 特定の条件で二重ループを抜ける */
    printf("\n例2: 九九の表で答えが50を超えたら終了\n");
    int found = 0;
    for (i = 1; i <= 9 && !found; i++) {
        for (j = 1; j <= 9; j++) {
            int result = i * j;
            if (result > 50) {
                printf("%d × %d = %d で終了\n", i, j, result);
                found = 1;  /* フラグを立てる */
                break;      /* 内側のループを抜ける */
            }
            printf("%d×%d=%2d ", i, j, result);
        }
        if (!found) printf("\n");
    }
    
    return 0;
}
```

#### continueを使った複雑な条件制御

```c
/*
 * continueを使った複雑な条件制御
 * 
 * 特定の条件をスキップしながら処理を継続
 */
#include <stdio.h>
int main(void)
{
    int i, j;
    
    printf("===== continueを使った条件制御 =====\n");
    
    /* 例1: 3の倍数と5の倍数をスキップ */
    printf("\n1から20で3の倍数と5の倍数以外:\n");
    for (i = 1; i <= 20; i++) {
        if (i % 3 == 0 || i % 5 == 0) {
            continue;  /* 次の繰り返しへ */
        }
        printf("%d ", i);
    }
    printf("\n");
    
    /* 例2: ネストしたループでのcontinue */
    printf("\n九九の表（偶数の段は計算をスキップ）:\n");
    for (i = 1; i <= 9; i++) {
        if (i % 2 == 0) {
            printf("%d の段: スキップ\n", i);
            continue;  /* 偶数の段をスキップ */
        }
        printf("%d の段: ", i);
        for (j = 1; j <= 9; j++) {
            printf("%2d ", i * j);
        }
        printf("\n");
    }
    
    return 0;
}
```

### 無限ループ ♾
意図的に終了しないループを作成することもあります。

#### 無限ループが必要な場面
「無限ループ」と聞くと怖く感じるかもしれませんが、実は多くのプログラムで使われています。

- ゲームのメインループ（ユーザーが終了するまで続く）
- サーバープログラム（常に要求を待ち受ける）
- 組み込みシステム（電源が入っている間ずっと動作）
**重要：** 無限ループを作るときは、必ず脱出方法（breakやプログラム終了条件）を用意しましょう！

#### 無限ループの作成方法

```c
/* 方法1: for文 */
for (;;) {
    /* 無限ループ */
    if (条件) break;
}

/* 方法2: while文 */
while (1) {
    /* 無限ループ */
    if (条件) break;
}

/* 方法3: do-while文 */
do {
    /* 無限ループ */
    if (条件) break;
} while (1);
```

#### 無限ループの実用例

```c
#include <stdio.h>
int main(void)
{
    int choice;
    
    while (1) {
        printf("\n1. 続行\n");
        printf("0. 終了\n");
        printf("選択: ");
        scanf("%d", &choice);
        
        if (choice == 0) {
            break;
        }
        
        printf("処理を続行します\n");
    }
    
    printf("終了しました\n");
    return 0;
}
```

### ループの最適化とベストプラクティス 
初心者がループを書く際に気をつけるべきポイントを紹介します。

#### 効率的なループ

```c
/* NG: 毎回strlen()を呼び出し */
for (i = 0; i < strlen(str); i++) {
    /* 処理 */
}

/* OK: 長さを事前に計算 */
len = strlen(str);
for (i = 0; i < len; i++) {
    /* 処理 */
}
```

#### ループ変数の適切な使用

```c
#include <stdio.h>
int main(void)
{
    int i;  /* C90では先頭で宣言 */
    
    for (i = 0; i < 5; i++) {
        printf("i = %d\n", i);
    }
    
    /* ループ後もiは有効 */
    printf("最終的なi = %d\n", i);
    
    return 0;
}
```

##  コンパイル方法
この章では以下のMakefileを使用してコンパイルができます。

```bash
# 全ての例題をコンパイル
make all
# 特定のプログラムをコンパイル
make loop_basic
# 実行
make run
# クリーンアップ
make clean
```

##  規格による違い

### C90での制限事項

- ループ変数は関数の先頭で宣言する必要がある
- for文内での変数宣言は不可

### C99以降の拡張

- for文内での変数宣言が可能

  ```c
  for (int i = 0; i < 10; i++)   /* C99以降 */
      /* 処理 */
  
  ```

##  よくある間違い
初心者がループで陥りやすいミスと、その対策を紹介します。

### 1. 無限ループの作成

```c
/* NG: 終了条件の記述ミス */
for (i = 10; i > 0; i++)   /* 最初から条件が偽 */
    /* 実行されない */
/* NG: 更新式の記述ミス */
for (i = 0; i < 10; i--)   /* 負の方向に進む */
    /* 無限ループ */
```

### 2. セミコロンの位置

```c
/* NG: for文の後にセミコロン */
for (i = 0; i < count; i++);  /* 空文が実行される */
    printf("%d\n", i);     /* ループ外で実行 */
/* OK: 正しい記述 */
for (i = 0; i < count; i++) 
    printf("%d\n", i);
```

### 3. ループ変数の範囲外アクセス
配列を使うときに特に注意が必要です。

```c
/* NG: 配列の範囲を超える */
int arr[10];
for (i = 0; i <= 10; i++) {  /* i=10で範囲外！ */
    arr[i] = i;  /* 配列は0～9までしかない */
}
/* OK: 正しい範囲 */
for (i = 0; i < 10; i++) {
    arr[i] = i;
}
```
**覚え方：** 配列のサイズがNなら、インデックスは0からN-1まで！

##  次の章へ
ループ処理を理解したら、[配列（基本編）](../arrays-basics/README.md) に進んでください。

##  参考資料

- [for文詳細](https://ja.cppreference.com/w/c/language/for)
- [while文詳細](https://ja.cppreference.com/w/c/language/while)
- [break・continue文](https://ja.cppreference.com/w/c/language/break)
