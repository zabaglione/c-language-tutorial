#!/bin/bash

# C言語学習教材 - 残存エラー修正スクリプト

echo "=== C言語学習教材 - 残存エラー修正スクリプト ==="
echo "処理開始..."

# すべてのREADME.mdファイルを処理
find . -name "README.md" -type f | while read -r file; do
    echo "処理中: $file"
    
    # 残存エラーの修正
    sed -i '' '
        # バイト数の誤変換を修正
        s/12481216バイト/バイト/g
        s/112481216バイト/1バイト/g
        s/212481216バイト/2バイト/g
        s/412481216バイト/4バイト/g
        s/812481216バイト/8バイト/g
        s/1612481216バイト/16バイト/g
        
        # 実行の重複を修正
        s/実実行/実行/g
        
        # 行が実行に誤変換された箇所を修正（文脈依存）
        s/実行のサイズ/行のサイズ/g
        s/実行数/行数/g
        /改実行/s/改実行/改行/g
        s/1実行コメント/1行コメント/g
        
        # 数値の誤変換を修正
        s/32つ/3つ/g
        s/に2ついて/について/g
        s/22つ/2つ/g
        
        # 回数関連の修正
        s/試実行1回数/試行回数/g
        s/比較1回数/比較回数/g
        s/テスト1回数/テスト回数/g
        s/関数呼出1回数/関数呼出回数/g
        s/実行1回/実行回/g
        
        # その他の修正
        s/に2つ/につ/g
        /^[0-9]\./!s/に2つ/につ/g
    ' "$file"
done

# 特定のパターンの追加修正
find . -name "README.md" -type f | while read -r file; do
    # 行番号のコンテキストで「行」を正しく修正
    sed -i '' '
        /[0-9]実行目/s/実行目/行目/g
        /第[0-9]実行/s/実行/行/g
        /[0-9]実行[0-9]列/s/実行/行/g
        /実行ごと/s/実行ごと/行ごと/g
        /各実行/s/各実行/各行/g
        /実行単位/s/実行単位/行単位/g
        /実行番号/s/実行番号/行番号/g
        /改実行/s/改実行/改行/g
        /実行列/s/実行列/行列/g
        /実行数/s/実行数/行数/g
        /縦.*実行/s/実行/行/g
        /横.*実行/s/実行/行/g
    ' "$file"
done

# .cファイルの修正も行う
find . -name "*.c" -type f | while read -r file; do
    echo "処理中: $file"
    
    if [ -f "$file" ]; then
        sed -i '' '
            # printf内のエラーを修正
            s/実実行/実行/g
            s/12481216バイト/バイト/g
        ' "$file"
    fi
done

echo ""
echo "=== 修正完了 ==="
echo "残存する文字列置換エラーを修正しました。"