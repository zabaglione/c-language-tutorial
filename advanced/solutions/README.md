# 第13章 解答集

## 演習13-1: 高度なプリプロセッサマクロ
**ファイル**: `ex13_1_macro_basics.c`, `ex13_1_macro_basics_c99.c`

基本的なプリプロセッサマクロの実装です。
- 数学定数、計算マクロ、ビット操作
- デバッグ支援マクロ（条件付きコンパイル）
- C90版：標準準拠のマクロ実装
- C99版：可変引数マクロ、`__func__`マクロ活用

## 演習13-2: 安全なメモリ操作マクロ
**ファイル**: `ex13_2_safe_memory.c`, `ex13_2_safe_memory_c99.c`

メモリ安全性を高めるマクロセットの実装です。
- NULLチェック付きメモリ操作
- 配列境界チェック
- メモリリーク追跡システム
- C90版：基本的な安全性チェック
- C99版：inline関数、可変引数マクロによる拡張

## 演習13-3: シンプルなメモリプール
**ファイル**: `ex13_3_memory_pool.c`, `ex13_3_memory_pool_c99.c`

固定サイズオブジェクト用メモリプールの実装です。
- O(1)での割り当て・解放
- フリーリスト管理
- フラグメンテーション対策
- C90版：基本的なプール実装
- C99版：型安全性の向上、統計機能追加

## 演習13-4: 汎用的なプリプロセッサライブラリ
**ファイル**: `ex13_4_generic_macros.c`, `ex13_4_generic_macros_c99.c`

高度なマクロプログラミング技法の実装です。
- 型チェック、汎用操作マクロ
- ループ展開、ベンチマークマクロ
- C90版：memcpyベースの汎用swap
- C99版：_Generic、typeof、複合リテラル活用

## 演習13-5: 高性能メモリアロケーター
**ファイル**: `ex13_5_allocator.c`, `ex13_5_allocator_c99.c`

マルチプール型カスタムアロケーターの実装です。
- サイズ別プール管理
- 高速割り当て・解放
- 詳細な統計情報
- C90版：基本的なプール選択アルゴリズム
- C99版：inline最適化、restrict修飾子活用

## 演習13-6: キャッシュフレンドリーなデータ構造
**ファイル**: `ex13_6_cache_vector.c`, `ex13_6_cache_vector_c99.c`

キャッシュ効率を考慮した動的配列の実装です。
- キャッシュラインアライメント
- プリフェッチヒント
- バルク操作の最適化
- C90版：基本的なアライメント対応
- C99版：フレキシブル配列メンバー、VLA活用

## 演習13-7: プリプロセッサベースのDSL
**ファイル**: `ex13_7_dsl.c`, `ex13_7_dsl_c99.c`

ドメイン固有言語の実装例です。
- 状態機械DSL
- イベント駆動システムDSL
- ワークフローDSL
- C90版：基本的なマクロDSL
- C99版：可変引数マクロによる表現力向上

## 演習13-8: ガベージコレクション機能付きメモリ管理
**ファイル**: `ex13_8_gc_framework.c`, `ex13_8_gc_framework_c99.c`

3つのGCアルゴリズムの実装です。
- マーク&スイープGC
- 参照カウント方式
- 世代別GC
- C90版：基本的なGCアルゴリズム
- C99版：インクリメンタルGC、クロージャ対応

## 演習13-9: リアルタイムメモリアロケーター
**ファイル**: `ex13_9_realtime.c`, `ex13_9_realtime_c99.c`

決定的時間保証を持つアロケーターの実装です。
- O(1)時間保証
- デッドライン管理
- WCET（最悪実行時間）追跡
- C90版：基本的なリアルタイム保証
- C99版：キャッシュカラリング、高度な統計

## ビルド方法

```bash
# 特定の解答をビルド
make ex13_1_macro_basics

# C99版をビルド
make ex13_1_macro_basics_c99

# すべての解答をビルド
make all

# 実行
./ex13_1_macro_basics
```

## 学習のポイント

1. **プリプロセッサの限界と可能性**
   - マクロの適切な使用場面
   - 型安全性の確保方法
   - デバッグの考慮

2. **メモリ管理の最適化**
   - カスタムアロケーターの設計
   - キャッシュ効率の考慮
   - リアルタイム性の保証

3. **C90とC99の違い**
   - 言語機能の進化
   - より安全で表現力豊かなコード
   - パフォーマンスの改善

4. **実践的な応用**
   - 組み込みシステム
   - ゲームエンジン
   - リアルタイムシステム